
为了获取HTTP事务请求方方面面的完整信息-你不得不使用比LWP::Simple更强大的模块，使用以面向对象作为核心思想的LWP套件。这个单元介绍使用LWP作为浏览器对象（使用它来发送请求）和响应对象（得到请求的返回结果）。你可以学习到使用基本的方法来构造请求和检查响应结果，这些技能将会在后续的章节如cookies,语言选择，爬虫等中用得到。

### 3.1. 基本模块 (The Basic Classes)

在LWP模块中，通过LWP::UserAgent中的浏览器对象执行GET,HEAD,POST请求，处理HTTP响应结果的模块叫HTTP::Response。这两个是主要对象，还有一些其他模块提供cookie管理或者用户代理功能可以用来做爬虫。还有一些对象用来处理非HTTP方向的web,像HTML模块。在这一章，我们使用这些模块来执行web请求。

逐个添加如下模块：
```sh
use LWP::UserAgent;
use HTTP::Response;
```
但是加载LWP::UserAgent和LWP::Response 使用如下方法最简单方便：
```sh
use LWP;               # same as previous two lines
```

如果你熟悉perl的面向对象编程，LWP模块会带给你一些真正的惊喜。你只需要知道这些基本的对象和访问函数的名字就可以了。如果你不了解面向对象编程，你需要掌握一下。附录G，“User's View of Object-Oriented Modules”将会给你提供一些面向对象的概念。想学习更多（包括如何写自己的对象），可以查看Programming Perl(O'Reilly)。


### 3.2. 使用LWP模块编程

第一步是初始化浏览器对象，他可以被用在程序中的其他地方。我们需要一个浏览器对象来执行HTTP请求，虽然可以在一个程序中使用多个浏览器对象，但我现在还没遇到使用多个的情况。
浏览器对象可以使用代理（一个帮你抓取web页面的服务器，例如防火墙，或者一个像Squid的web缓存）。使用calling_env_proxy()来检查环境中是否设置过代理：

```sh
use LWP::UserAgent;
my $browser = LWP::UserAgent->new( );
$browser->env_proxy( ); # if we're behind a firewall
```
对于大多数的客户端这是全部的初始化了。当你做完了这些以后，除了get(), head(), post()，这些以外没什么可做的了。例如：
```sh
$url = 'http://www.guardian.co.uk/';
my $response = $browser->get($url);
```

然后你可以调用一些方法来检查响应状态，提取内容等等。例如，以下代码用来保证我们可以成功的抓取html文档而不必担心被截断，然后输除一段信息告诉我们"Madonna"或者"Arkansas"是否在文件内容中出现过：

```sh
die "Hmm, error \"", $response->status_line( ),
  "\" when getting $url"  unless $response->is_success( );
my $content_type = $response->content_type( );
die "Hm, unexpected content type $content_type from $url"
   unless $content_type eq 'text/html';
my $content = $response->content( );
die "Odd, the content from $url is awfully short!"
   if length($content) < 3000;
if($content =~ m/Madonna|Arkansas/i) {
   print "<!-- The news today is IMPORTANT -->\n",
         $content;
} else {
   print "$url has no news of ANY CONCEIVABLE IMPORTANCE!\n";
}
```

正如你所看到的一样，响应对象包含从服务器请求到的所有数据（或者一个关于访问浏览器失败的错误信息），然后我们使用方法来获得数据。有一些储存器来保存响应数据的不同部分（eg.状态行），然后有一个非常方便的函数告诉我们响应是否成功（is_success())。

这就是一个可工作的完整的LWP程序了！

